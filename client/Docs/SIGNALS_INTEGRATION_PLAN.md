# üîå Signals Integration ‚Äî Implementation Plan

–î–∞—Ç–∞: 18 —Å–µ–Ω—Ç—è–±—Ä—è 2025
–°—Ç–∞—Ç—É—Å: Implemented ‚úÖ

## 1) –¶–µ–ª—å
–ü–æ–¥–∫–ª—é—á–∏—Ç—å –º–æ–¥—É–ª—å `signals` –∫ —Å–æ–±—ã—Ç–∏–π–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ: —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –≤—ã–¥–∞–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏ –∏ –±–µ–∑ –ø—Ä—è–º–æ–π —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥—É–ª—è–º–∏ —Ç—Ä–µ—è/–ø–ª–µ–µ—Ä–∞ –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.

## 2) –†–æ–ª—å –∏ –≥—Ä–∞–Ω–∏—Ü—ã
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ‚Äî —Ç–æ–ª—å–∫–æ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç: –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è EventBus, –º–∞–ø–ø–∏—Ç –∏—Ö –≤ `SignalRequest` –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `SignalService.emit()`.
- –í—Å—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è/–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤ ‚Äî –≤–Ω—É—Ç—Ä–∏ –º–æ–¥—É–ª—è `signals` (–∫–∞–Ω–∞–ª—ã).

## 3) –ü–æ–¥–ø–∏—Å–∫–∏ –∏ –º–∞–ø–ø–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
| –°–æ–±—ã—Ç–∏–µ | –£—Å–ª–æ–≤–∏–µ | Pattern |
|---|---|---|
| app.mode_changed | mode == LISTENING | listen_start |
| voice.mic_opened | ‚Äî | listen_start |
| app.mode_changed | mode == PROCESSING | processing_start (–æ–ø—Ü.) |
| playback.completed | ‚Äî | done |
| grpc.request_failed | ‚Äî | error |
| voice.recognition_failed | ‚Äî | error |
| interrupt.request | ‚Äî | cancel |
| playback.cancelled | ‚Äî | cancel |

–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è listen_start (mode_changed –∏ mic_opened) –ø–æ–¥–∞–≤–ª—è—é—Ç—Å—è cooldown‚Äë–æ–º.
- –ù–∞–ª–∏—á–∏–µ/–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π.

## 4) –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ –∫–æ–¥–µ; —Ä–∞—Å—à–∏—Ä—è–µ–º–æ)
```yaml
integrations:
  signals:
    enabled: true
    patterns:
      listen_start: { audio: true, visual: false, volume: 0.2, tone_hz: 880, duration_ms: 120, cooldown_ms: 300 }
      processing_start: { audio: false, visual: true }
      done: { audio: true }
      error: { audio: true }
      cancel: { audio: true }
```

## 5) API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–∏—Ç–æ–≥)
```python
# signal_integration.py (–∫–∞—Ä–∫–∞—Å)
class SignalIntegration:
    def __init__(self, event_bus, state_manager, error_handler, signal_service, config): ...
    async def initialize(self) -> bool: ...  # –ø–æ–¥–ø–∏—Å–∫–∏ EventBus
    async def start(self) -> bool: ...
    async def stop(self) -> bool: ...
```

## 6) –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∫–ª—é—á–µ–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º—É (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)
1. –°–æ–∑–¥–∞—Ç—å SignalService –∏–∑ –º–æ–¥—É–ª—è `signals`, —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–∞–Ω–∞–ª—ã –ø–æ –∫–æ–Ω—Ñ–∏–≥—É.
2. –°–æ–∑–¥–∞—Ç—å SignalIntegration –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `SimpleModuleCoordinator`.
3. –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è; –≤–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Å–∏–≥–Ω–∞–ª—ã –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –º–∞–ø–ø–∏–Ω–≥–∞.
4. –ü—Ä–æ—Ç—è–Ω—É—Ç—å –º–µ—Ç—Ä–∏–∫–∏/–ª–æ–≥–∏ –≤ ErrorHandler/LoggingManager.

## 7) –ì–æ–Ω–∫–∏ –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å
- Per‚Äëpattern cooldown –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç ¬´–¥—Ä–µ–±–µ–∑–≥¬ª (listen_start –º–æ–∂–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∏–∑ –¥–≤—É—Ö —Å–æ–±—ã—Ç–∏–π –ø–æ–¥—Ä—è–¥).
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–µ –¥–µ—Ä–∂–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤; –≤—Å—è –æ—á–µ—Ä–µ–¥—å –∏ –ø–æ–¥–∞–≤–ª–µ–Ω–∏—è ‚Äî –≤ —Å–µ—Ä–≤–∏—Å–µ.
- –õ—é–±—ã–µ –æ—à–∏–±–∫–∏ –≤ –∫–∞–Ω–∞–ª–∞—Ö –Ω–µ –º–µ—à–∞—é—Ç –æ—Å—Ç–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ; –ø—É–±–ª–∏–∫—É–µ–º `signal.failed` –∏ –ª–æ–≥–∏—Ä—É–µ–º.

## 8) –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã: –≤—Ö–æ–¥ –≤ LISTENING ‚Üí –æ–¥–∏–Ω —Å–∏–≥–Ω–∞–ª, –±–µ–∑ –¥—É–±–ª–µ–π; playback.completed ‚Üí done; error/cancel.
- –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–π –∫–µ–π—Å: —Å–µ—Ä–∏—è –±—ã—Å—Ç—Ä—ã—Ö mode_changed ‚Üí —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Å–∏–≥–Ω–∞–ª –±–ª–∞–≥–æ–¥–∞—Ä—è cooldown.

## 9) Acceptance Criteria

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω `EventBusAudioSink`, –ø—É–±–ª–∏–∫—É—é—â–∏–π `playback.signal` —Å PCM. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ `SpeechPlaybackIntegration` –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç —Å–∏–≥–Ω–∞–ª –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ. –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏ `priority` –≤ `EventBus.publish` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞.
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–µ –¥—É–±–ª–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –º–æ–¥—É–ª–µ–π; –≤—Å–µ —Å–∏–≥–Ω–∞–ª—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ `SignalService`.
- –°–∏–≥–Ω–∞–ª—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∫–æ–Ω—Ñ–∏–≥—É; –Ω–µ—Ç –≥–æ–Ω–æ–∫/–¥—É–±–ª–µ–π; –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç.
