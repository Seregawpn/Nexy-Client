# üîê Login/Auth + Client Chat ‚Äî Plan

–î–∞—Ç–∞: 18 —Å–µ–Ω—Ç—è–±—Ä—è 2025
–°—Ç–∞—Ç—É—Å: Draft ‚Üí Ready for Impl

## –¶–µ–ª—å
- –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (token‚Äëbased) –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —á–∞—Ç (CLI/–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π UI) –ø–æ–≤–µ—Ä—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ gRPC‚Äë–ø–æ—Ç–æ–∫–∞.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ (macOS Keychain).
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ `authorization: Bearer <token>` –≤ metadata –≤—Å–µ—Ö gRPC –∑–∞–ø—Ä–æ—Å–æ–≤.
- CLI —á–∞—Ç: –≤–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞, –ø–æ–∫–∞–∑ –ø–æ—Ç–æ–∫–æ–≤—ã—Ö `text_chunk`, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ `audio_chunk` —á–µ—Ä–µ–∑ —Ç–µ–∫—É—â–∏–π –ø–ª–µ–µ—Ä.
- –°–æ—Å—Ç–æ—è–Ω–∏–µ: –∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è, –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ø–∞–º—è—Ç–∏ (N —Å–æ–æ–±—â–µ–Ω–∏–π), —Å–±—Ä–æ—Å/–ª–æ–≥–∞—É—Ç.
- –ì—Ä–µ–π—Å—Ñ—É–ª –ø—Ä–∏ –æ—Ñ—Ñ–ª–∞–π–Ω–µ: —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å, –ø–æ–≤—Ç–æ—Ä –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞/–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- `modules/grpc_client/core/grpc_client.py` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É `metadata` (dict ‚Üí —Å–ø–∏—Å–æ–∫ –ø–∞—Ä) –¥–ª—è StreamAudio; –ø—Ä–æ–∫–∏–Ω—É—Ç—å –∏–∑–≤–Ω–µ.
- `integration/integrations/grpc_client_integration.py` ‚Äî –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ç–æ–∫–µ–Ω, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å metadata; –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
- Keychain helper (–Ω–æ–≤—ã–π –º–æ–¥—É–ª—å): `client/modules/auth/keychain.py` (get_token/set_token/delete_token) —á–µ—Ä–µ–∑ `keyring`/Security.
- CLI —á–∞—Ç: `client/tools/chat_cli.py` (–º–∏–Ω–∏–º—É–º) ‚Äî —á–∏—Ç–∞–µ—Ç —Ç–æ–∫–µ–Ω, –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ª–æ–≥–∏–Ω, –∑–∞—Ç–µ–º REPL.

## –°—Ü–µ–Ω–∞—Ä–∏–∏
1) Login: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —Ç–æ–∫–µ–Ω ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Keychain ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ (–æ—Ç–≤–µ—Ç 401/403 ‚Üí –æ—à–∏–±–∫–∞/–ø–æ–≤—Ç–æ—Ä).
2) Chat: –≤–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ ‚Üí –∑–∞—Ö–≤–∞—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Üí gRPC StreamAudio(prompt, screenshot, hwid, metadata) ‚Üí –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞/–∞—É–¥–∏–æ.
3) Logout: —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ ‚Üí –æ—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è.

## –¢–æ—á–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- gRPC: `GrpcClient.stream_audio()` –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `metadata: Optional[Dict[str,str]] = None` –∏ –ø—Ä–æ–±—Ä–æ—Å –≤ `StreamingServiceStub(...).StreamAudio(request, timeout=..., metadata=metadata_list)`.
- Integration: —Ö—Ä–∞–Ω–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω, –æ–±–Ω–æ–≤–ª—è—Ç—å –ø–æ —Å–æ–±—ã—Ç–∏—é `auth.token_updated`.
- CLI: –∫–æ–º–∞–Ω–¥—ã `/login <token>`, `/logout`, `/send <text>`, `/quit`.

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ù–µ—Ç —Ç–æ–∫–µ–Ω–∞ ‚Üí –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ `/login`.
- 401/403 ‚Üí –æ—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è.
- –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏ ‚Üí retry —á–µ—Ä–µ–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π RetryManager.

## Acceptance Criteria
- –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è/—á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ Keychain.
- gRPC –≤—ã–∑–æ–≤—ã —Å–æ–¥–µ—Ä–∂–∞—Ç `authorization` metadata.
- CLI —á–∞—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–≤–æ–¥ –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ø–æ—Ç–æ–∫–æ–≤—ã–π —Ç–µ–∫—Å—Ç; –∞—É–¥–∏–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —á–µ—Ä–µ–∑ —Ç–µ–∫—É—â–∏–π –ø–ª–µ–µ—Ä.
- –õ–æ–≥–∞—É—Ç —É–¥–∞–ª—è–µ—Ç —Ç–æ–∫–µ–Ω –∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –¥–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ª–æ–≥–∏–Ω–∞.

## –î–∞–ª–µ–µ
- (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –û–±–Ω–æ–≤–∏—Ç—å —Ç—Ä—ç–π‚Äë–º–µ–Ω—é: –ø—É–Ω–∫—Ç Login/Logout, –∏–Ω–¥–∏–∫–∞—Ü–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
- (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ –≤ —Ñ–∞–π–ª (–ª–æ–∫–∞–ª—å–Ω–æ), —Å —Ä–æ—Ç–∞—Ü–∏–µ–π.

