#!/usr/bin/env python3
"""
–¢–µ—Å—Ç —É–ª—É—á—à–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏ InputHandler —Å —Ñ–ª–∞–≥–æ–º –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è
"""

import asyncio
import time
from rich.console import Console
from rich.table import Table

console = Console()

async def test_improved_input_handler():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —É–ª—É—á—à–µ–Ω–Ω—É—é –ª–æ–≥–∏–∫—É InputHandler"""
    console.print("üöÄ –¢–µ—Å—Ç —É–ª—É—á—à–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏ InputHandler")
    console.print("=" * 60)
    
    # –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É —É–ª—É—á—à–µ–Ω–∏–π
    table = Table(title="üìä –£–ª—É—á—à–µ–Ω–∏—è InputHandler")
    table.add_column("–ü—Ä–æ–±–ª–µ–º–∞", style="red")
    table.add_column("–†–µ—à–µ–Ω–∏–µ", style="green")
    table.add_column("–†–µ–∑—É–ª—å—Ç–∞—Ç", style="blue")
    
    improvements = [
        ("–°–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä—ã–π —Ç–∞–π–º–µ—Ä (10ms)", "–£–≤–µ–ª–∏—á–µ–Ω –¥–æ 150ms", "–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –Ω–µ—Ç race condition"),
        ("–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è", "–î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ interrupting", "–ú–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è"),
        ("–ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å–æ–±—ã—Ç–∏–π", "–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞", "–°–Ω–∞—á–∞–ª–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ, –ø–æ—Ç–æ–º –∞–∫—Ç–∏–≤–∞—Ü–∏—è"),
        ("Race condition", "–§–ª–∞–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è", "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏"),
    ]
    
    for problem, solution, result in improvements:
        table.add_row(problem, solution, result)
    
    console.print(table)
    
    console.print("\nüéØ –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:")
    console.print("  1. –ü—Ä–æ–±–µ–ª –Ω–∞–∂–∞—Ç ‚Üí —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ñ–ª–∞–≥ interrupting")
    console.print("  2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è interrupt_or_cancel (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)")
    console.print("  3. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–∞–π–º–µ—Ä –Ω–∞ 150ms –¥–ª—è start_recording")
    console.print("  4. –ü—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ —Ç–∞–π–º–µ—Ä–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ñ–ª–∞–≥ interrupting")
    console.print("  5. –ï—Å–ª–∏ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è ‚Üí –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –º–∏–∫—Ä–æ—Ñ–æ–Ω")
    console.print("  6. –ü—Ä–∏ –æ—Ç–ø—É—Å–∫–∞–Ω–∏–∏ –ø—Ä–æ–±–µ–ª–∞ —Ñ–ª–∞–≥ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è")
    
    console.print("\n‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏:")
    console.print("  ‚Ä¢ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –º–µ–∂–¥—É –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ–º –∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π")
    console.print("  ‚Ä¢ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–µ–∑ race conditions")
    console.print("  ‚Ä¢ –ß–µ—Ç–∫–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–±—ã—Ç–∏–π")
    console.print("  ‚Ä¢ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É InputHandler –∏ StateManager")
    
    console.print("\nüîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:")
    console.print("  ‚Ä¢ –ó–∞–¥–µ—Ä–∂–∫–∞ —Ç–∞–π–º–µ—Ä–∞: 150ms (–≤–º–µ—Å—Ç–æ 10ms)")
    console.print("  ‚Ä¢ –§–ª–∞–≥ interrupting –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è")
    console.print("  ‚Ä¢ –ú–µ—Ç–æ–¥ reset_interrupt_flag() –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ —Å–±—Ä–æ—Å–∞")
    console.print("  ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–¥ –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞")

if __name__ == "__main__":
    try:
        asyncio.run(test_improved_input_handler())
    except KeyboardInterrupt:
        console.print("\nüëã –í—ã—Ö–æ–¥...")
    except Exception as e:
        console.print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
