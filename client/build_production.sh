#!/bin/bash
set -e

echo "üöÄ –ü–æ–ª–Ω–∞—è —Å–±–æ—Ä–∫–∞ Nexy AI Voice Assistant –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤..."
./check_certificates.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
if ! command -v SwitchAudioSource &> /dev/null; then
    echo "‚ùå SwitchAudioSource –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: brew install switchaudio-osx"
    exit 1
fi

if [ ! -d "/usr/local/lib/Sparkle.framework" ]; then
    echo "‚ùå Sparkle Framework –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: brew install sparkle"
    exit 1
fi

echo "‚úÖ –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞–π–¥–µ–Ω—ã"

# –≠—Ç–∞–ø 1: –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
echo "üîß –≠—Ç–∞–ø 1: –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
pyinstaller nexy.spec --clean --noconfirm

# –≠—Ç–∞–ø 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Sparkle
echo "üîÑ –≠—Ç–∞–ø 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Sparkle..."
./integrate_sparkle.sh

# –≠—Ç–∞–ø 3: –°–æ–∑–¥–∞–Ω–∏–µ PKG
echo "üì¶ –≠—Ç–∞–ø 3: –°–æ–∑–¥–∞–Ω–∏–µ PKG..."
./create_pkg.sh

# –≠—Ç–∞–ø 4: –ù–æ—Ç–∞—Ä–∏–∑–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
echo "üîê –≠—Ç–∞–ø 4: –ù–æ—Ç–∞—Ä–∏–∑–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)..."
echo "‚ÑπÔ∏è –î–ª—è –Ω–æ—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ: ./notarize.sh Nexy_AI_Voice_Assistant_v1.71.0.pkg"

echo "üéâ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!"
echo "üì¶ –ì–æ—Ç–æ–≤—ã–π PKG: Nexy_AI_Voice_Assistant_v1.71.0.pkg"
echo "‚ÑπÔ∏è –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: brew install switchaudio-osx sparkle"
