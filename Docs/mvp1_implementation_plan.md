# MVP 1: –ü–ª–∞–Ω –ø–µ—Ä–µ–≤–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
## "–ü–æ—à–∞–≥–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞"

---

## üéØ **–¶–µ–ª—å –¥–æ–∫—É–º–µ–Ω—Ç–∞:**
–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é MVP 1 –≤ **–ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í–û–ï –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ –ü–†–ò–õ–û–ñ–ï–ù–ò–ï** —Å —á—ë—Ç–∫–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –¥–µ–π—Å—Ç–≤–∏–π.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö –∫–æ–Ω—Ü—É 18-–≥–æ –¥–Ω—è —É –Ω–∞—Å –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—é—â–µ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–º–∞–Ω–¥–æ–π `python main.py` –∏ —Å—Ä–∞–∑—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å!

---

## üìã **–û–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é**

### **1. –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:**
- **macOS 12.0+** (Monterey –∏ –≤—ã—à–µ)
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ Intel –∏ Apple Silicon**
- **–ú–∏–Ω–∏–º—É–º 8GB RAM**
- **2GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ**

### **2. –†–∞–∑—Ä–µ—à–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã:**
- **Accessibility** - –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- **Screen Recording** - –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ —ç–∫—Ä–∞–Ω–∞
- **Microphone** - –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏
- **Network** - –¥–ª—è Edge TTS –∏ Gemini API

### **3. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- **Python 3.9+**
- **macOS SDK** (–¥–ª—è PyObjC)
- **–ò–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ** (–¥–ª—è TTS –∏ LLM)

---

## üèóÔ∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:**
```
assistant_app/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ core/           # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ ui/            # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îÇ   ‚îú‚îÄ‚îÄ services/      # –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îî‚îÄ‚îÄ utils/         # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ tests/             # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ config/            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ requirements.txt   # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README.md         # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
1. **SpaceController** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–º
2. **ScreenCapture** - –∑–∞—Ö–≤–∞—Ç —ç–∫—Ä–∞–Ω–∞
3. **EdgeTTSEngine** - —Å–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏
4. **SpeechRecognition** - —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏
5. **GeminiClient** - –∞–Ω–∞–ª–∏–∑ —ç–∫—Ä–∞–Ω–∞
6. **Analytics** - —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫

---

## üöÄ **–ü–æ—à–∞–≥–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**

---

### **–®–ê–ì 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–î–µ–Ω—å 1)**

#### **1.1 –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞:**
```bash
# –°–æ–∑–¥–∞—ë–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞
mkdir assistant_app
cd assistant_app
python -m venv venv
source venv/bin/activate

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

#### **1.2 requirements.txt:**
```txt
# –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
edge-tts==6.1.9
SpeechRecognition==3.10.0
PyAudio==0.2.11
grpcio==1.59.0
protobuf==4.24.4
Pillow==10.0.0

# macOS —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ
pyobjc-framework-Quartz==9.2
pyobjc-framework-Cocoa==9.2

# –£—Ç–∏–ª–∏—Ç—ã
numpy==1.24.0
asyncio==3.4.3
```

#### **1.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π:**
```python
# check_permissions.py
import Quartz
import speech_recognition as sr

def check_permissions():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è"""
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ Accessibility
    try:
        Quartz.AXUIElementCreateSystemWide()
        print("‚úÖ Accessibility —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ")
    except:
        print("‚ùå –ù—É–∂–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ Accessibility")
        
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
    try:
        recognizer = sr.Recognizer()
        microphone = sr.Microphone()
        print("‚úÖ –ú–∏–∫—Ä–æ—Ñ–æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω")
    except:
        print("‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–æ–º")
        
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∏—Å–∏ —ç–∫—Ä–∞–Ω–∞
    try:
        # –ü—Ä–æ–±—É–µ–º –∑–∞—Ö–≤–∞—Ç–∏—Ç—å —ç–∫—Ä–∞–Ω
        pass
        print("‚úÖ –ó–∞–ø–∏—Å—å —ç–∫—Ä–∞–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞")
    except:
        print("‚ùå –ù—É–∂–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ Screen Recording")
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ì–æ—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

### **–®–ê–ì 2: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–º (–î–µ–Ω—å 2-3)**

#### **2.1 –°–æ–∑–¥–∞–Ω–∏–µ SpaceController:**
```python
# src/core/space_controller.py
import Quartz
import time
import threading
from typing import Callable

class SpaceController:
    def __init__(self):
        self.is_active = False
        self.press_start_time = 0
        self.long_press_threshold = 0.6  # 600–º—Å
        self.callbacks = {}
        
    def start_monitoring(self):
        """–ó–∞–ø—É—Å–∫–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–±–µ–ª–∞"""
        # –°–æ–∑–¥–∞—ë–º Event Tap –¥–ª—è –ø—Ä–æ–±–µ–ª–∞
        event_mask = Quartz.kCGEventKeyDown | Quartz.kCGEventKeyUp
        
        def callback(proxy, event_type, event, refcon):
            if event_type == Quartz.kCGEventKeyDown:
                self._handle_key_down(event)
            elif event_type == Quartz.kCGEventKeyUp:
                self._handle_key_up(event)
            return event
            
        # –°–æ–∑–¥–∞—ë–º Event Tap
        event_tap = Quartz.CGEventTapCreate(
            Quartz.kCGSessionEventTap,
            Quartz.kCGHeadInsertEventTap,
            Quartz.kCGEventTapOptionDefault,
            event_mask,
            callback,
            None
        )
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
        run_loop = Quartz.CFRunLoopGetCurrent()
        Quartz.CGEventTapEnable(event_tap, True)
        
    def _handle_key_down(self, event):
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏–µ –∫–ª–∞–≤–∏—à–∏"""
        keycode = Quartz.CGEventGetKeycode(event)
        
        if keycode == 49:  # –ü—Ä–æ–±–µ–ª
            self.press_start_time = time.time()
            
    def _handle_key_up(self, event):
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–ø—É—Å–∫–∞–Ω–∏–µ –∫–ª–∞–≤–∏—à–∏"""
        keycode = Quartz.CGEventGetKeycode(event)
        
        if keycode == 49:  # –ü—Ä–æ–±–µ–ª
            press_duration = time.time() - self.press_start_time
            
            if press_duration >= self.long_press_threshold:
                if not self.is_active:
                    self._activate_assistant()
                else:
                    self._deactivate_assistant()
            else:
                if self.is_active:
                    self._interrupt_assistant()
                    
    def _activate_assistant(self):
        """–ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞"""
        self.is_active = True
        if 'activate' in self.callbacks:
            self.callbacks['activate']()
            
    def _deactivate_assistant(self):
        """–î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞"""
        self.is_active = False
        if 'deactivate' in self.callbacks:
            self.callbacks['deactivate']()
            
    def _interrupt_assistant(self):
        """–ü–µ—Ä–µ–±–∏–≤–∞–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞"""
        if 'interrupt' in self.callbacks:
            self.callbacks['interrupt']()
            
    def register_callback(self, event_type: str, callback: Callable):
        """–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç callback –¥–ª—è —Å–æ–±—ã—Ç–∏—è"""
        self.callbacks[event_type] = callback
```

#### **2.2 –ó–∞—â–∏—Ç–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π:**
```python
# src/core/context_detector.py
import Quartz

class ContextDetector:
    def __init__(self):
        pass
        
    def is_text_field_focused(self) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ —Ñ–æ–∫—É—Å –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º –ø–æ–ª–µ"""
        try:
            # –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å —Ñ–æ–∫—É—Å–æ–º
            focused_element = Quartz.AXUIElementCreateSystemWide()
            focused = Quartz.AXUIElementCopyAttributeValue(
                focused_element, 
                Quartz.kAXFocusedUIElementAttribute
            )
            
            if focused:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–æ–ª—å —ç–ª–µ–º–µ–Ω—Ç–∞
                role = Quartz.AXUIElementCopyAttributeValue(
                    focused, 
                    Quartz.kAXRoleAttribute
                )
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–π –ª–∏ —ç–ª–µ–º–µ–Ω—Ç
                editable = Quartz.AXUIElementCopyAttributeValue(
                    focused, 
                    Quartz.kAXEditableAttribute
                )
                
                return bool(editable)
                
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞: {e}")
            
        return False
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–∞–±–æ—Ç–∞—é—â–µ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–º —Å –∑–∞—â–∏—Ç–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π

---

### **–®–ê–ì 3: –ó–∞—Ö–≤–∞—Ç —ç–∫—Ä–∞–Ω–∞ (–î–µ–Ω—å 4-5)**

#### **3.1 –°–æ–∑–¥–∞–Ω–∏–µ ScreenCapture:**
```python
# src/core/screen_capture.py
import Quartz
from PIL import Image
import io
import time

class ScreenCapture:
    def __init__(self):
        self.max_width = 1024
        self.quality = 80
        
    def capture_active_window(self):
        """–ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–µ –æ–∫–Ω–æ"""
        try:
            # –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ –æ–∫–Ω–æ
            windows = Quartz.CGWindowListCopyWindowInfo(
                Quartz.kCGWindowListOptionOnScreenOnly | Quartz.kCGWindowListExcludeDesktopElements,
                Quartz.kCGNullWindowID
            )
            
            # –ù–∞—Ö–æ–¥–∏–º –∞–∫—Ç–∏–≤–Ω–æ–µ –æ–∫–Ω–æ
            active_window = None
            for window in windows:
                if window.get(Quartz.kCGWindowLayer) == 0:  # –û—Å–Ω–æ–≤–Ω–æ–π —Å–ª–æ–π
                    active_window = window
                    break
                    
            if not active_window:
                return None, {}
                
            # –ü–æ–ª—É—á–∞–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –æ–∫–Ω–∞
            bounds = active_window.get(Quartz.kCGWindowBounds)
            x, y, width, height = bounds['X'], bounds['Y'], bounds['Width'], bounds['Height']
            
            # –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            image = Quartz.CGWindowListCreateImage(
                bounds,
                Quartz.kCGWindowListOptionIncludingWindow,
                active_window.get(Quartz.kCGWindowID),
                Quartz.kCGWindowImageBoundsIgnoreFraming
            )
            
            # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ PIL Image
            width = Quartz.CGImageGetWidth(image)
            height = Quartz.CGImageGetHeight(image)
            
            # –°–æ–∑–¥–∞—ë–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
            context = Quartz.CGBitmapContextCreate(
                None, width, height, 8, width * 4,
                Quartz.CGColorSpaceCreateDeviceRGB(),
                Quartz.kCGImageAlphaPremultipliedLast
            )
            
            # –†–∏—Å—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            Quartz.CGContextDrawImage(context, Quartz.CGRectMake(0, 0, width, height), image)
            
            # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            data = Quartz.CGBitmapContextGetData(context)
            
            # –°–æ–∑–¥–∞—ë–º PIL Image
            pil_image = Image.frombytes('RGBA', (width, height), data)
            
            # –ò–∑–º–µ–Ω—è–µ–º —Ä–∞–∑–º–µ—Ä
            if width > self.max_width:
                ratio = self.max_width / width
                new_height = int(height * ratio)
                pil_image = pil_image.resize((self.max_width, new_height), Image.Resampling.LANCZOS)
                
            # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ WebP
            output = io.BytesIO()
            pil_image.save(output, format='WebP', quality=self.quality, optimize=True)
            image_bytes = output.getvalue()
            
            # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
            metadata = {
                'app_name': active_window.get(Quartz.kCGWindowOwnerName, 'Unknown'),
                'window_title': active_window.get(Quartz.kCGWindowName, ''),
                'bounds': bounds,
                'timestamp': time.time(),
                'size_bytes': len(image_bytes)
            }
            
            return image_bytes, metadata
            
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –∑–∞—Ö–≤–∞—Ç–∞ —ç–∫—Ä–∞–Ω–∞: {e}")
            return None, {}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–∞–±–æ—Ç–∞—é—â–∏–π –∑–∞—Ö–≤–∞—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–∫–Ω–∞ –≤ WebP —Ñ–æ—Ä–º–∞—Ç–µ

---

### **–®–ê–ì 4: Edge TTS (–î–µ–Ω—å 6-7)**

#### **4.1 –°–æ–∑–¥–∞–Ω–∏–µ EdgeTTSEngine:**
```python
# src/services/edge_tts_engine.py
import edge_tts
import asyncio
import io
import pygame
from typing import Optional

class EdgeTTSEngine:
    def __init__(self):
        self.voice = "ru-RU-SvetlanaNeural"
        self.rate = "+0%"
        self.volume = "+0%"
        self.is_speaking = False
        
    async def synthesize(self, text: str, language: str = "ru") -> bytes:
        """–°–∏–Ω—Ç–µ–∑–∏—Ä—É–µ—Ç —Ä–µ—á—å"""
        try:
            # –í—ã–±–∏—Ä–∞–µ–º –≥–æ–ª–æ—Å –ø–æ —è–∑—ã–∫—É
            if language == "ru":
                voice = "ru-RU-SvetlanaNeural"
            else:
                voice = "en-US-AriaNeural"
                
            # –°–æ–∑–¥–∞—ë–º –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é
            communicate = edge_tts.Communicate(
                text, 
                voice,
                rate=self.rate,
                volume=self.volume
            )
            
            # –°–æ–±–∏—Ä–∞–µ–º –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã–µ
            audio_data = b""
            async for chunk in communicate.stream():
                if chunk["type"] == "audio":
                    audio_data += chunk["data"]
                    
            return audio_data
            
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ TTS: {e}")
            return b""
            
    def play_audio(self, audio_bytes: bytes):
        """–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –∞—É–¥–∏–æ"""
        try:
            # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º pygame –¥–ª—è –∞—É–¥–∏–æ
            pygame.mixer.init()
            
            # –°–æ–∑–¥–∞—ë–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
            temp_file = io.BytesIO(audio_bytes)
            
            # –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º
            pygame.mixer.music.load(temp_file)
            pygame.mixer.music.play()
            
            self.is_speaking = True
            
            # –ñ–¥—ë–º –æ–∫–æ–Ω—á–∞–Ω–∏—è
            while pygame.mixer.music.get_busy():
                pygame.time.wait(100)
                
            self.is_speaking = False
            
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è: {e}")
            
    def stop_speaking(self):
        """–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–µ—á—å"""
        if self.is_speaking:
            pygame.mixer.music.stop()
            self.is_speaking = False
            
    def set_rate(self, rate: str):
        """–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–µ—á–∏"""
        self.rate = rate
        
    def set_voice(self, voice: str):
        """–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≥–æ–ª–æ—Å"""
        self.voice = voice
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–∞–±–æ—Ç–∞—é—â–∏–π —Å–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏ —á–µ—Ä–µ–∑ Edge TTS

---

### **–®–ê–ì 5: –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ (–î–µ–Ω—å 8-9)**

#### **5.1 –°–æ–∑–¥–∞–Ω–∏–µ SpeechRecognition:**
```python
# src/services/speech_recognition.py
import speech_recognition as sr
import pyaudio
import time

class LocalSpeechRecognition:
    def __init__(self):
        self.recognizer = sr.Recognizer()
        self.microphone = sr.Microphone()
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        self.recognizer.energy_threshold = 4000
        self.recognizer.dynamic_energy_threshold = True
        self.recognizer.pause_threshold = 0.8
        
    def listen_for_command(self, timeout: float = 10.0) -> str:
        """–°–ª—É—à–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        try:
            with self.microphone as source:
                # –ü–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ–º—Å—è –ø–æ–¥ —à—É–º
                self.recognizer.adjust_for_ambient_noise(source, duration=0.5)
                
                # –°–ª—É—à–∞–µ–º –∞—É–¥–∏–æ
                audio = self.recognizer.listen(
                    source, 
                    timeout=timeout, 
                    phrase_time_limit=15
                )
                
                # –†–∞—Å–ø–æ–∑–Ω–∞—ë–º —á–µ—Ä–µ–∑ Google Speech API
                text = self.recognizer.recognize_google(
                    audio, 
                    language='ru-RU'
                )
                
                return text.lower()
                
        except sr.WaitTimeoutError:
            return "timeout"
        except sr.UnknownValueError:
            return "unknown"
        except sr.RequestError as e:
            print(f"–û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è: {e}")
            return "error"
            
    def is_listening(self) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–ª—É—à–∞–µ—Ç –ª–∏ —Å–∏—Å—Ç–µ–º–∞"""
        return hasattr(self, '_listening') and self._listening
        
    def start_listening(self):
        """–ù–∞—á–∏–Ω–∞–µ—Ç –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ"""
        self._listening = True
        
    def stop_listening(self):
        """–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ"""
        self._listening = False
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–∞–±–æ—Ç–∞—é—â–µ–µ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏

---

### **–®–ê–ì 6: Gemini API (–î–µ–Ω—å 10-11)**

#### **6.1 –°–æ–∑–¥–∞–Ω–∏–µ GeminiClient:**
```python
# src/services/gemini_client.py
import google.generativeai as genai
import json
import base64
from typing import Dict, Any

class GeminiClient:
    def __init__(self, api_key: str):
        genai.configure(api_key=api_key)
        self.model = genai.GenerativeModel('gemini-1.5-flash')
        
    def analyze_screen(self, image_bytes: bytes, metadata: Dict[str, Any]) -> Dict[str, Any]:
        """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —ç–∫—Ä–∞–Ω —á–µ—Ä–µ–∑ Gemini"""
        try:
            # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ base64
            image_base64 = base64.b64encode(image_bytes).decode('utf-8')
            
            # –°–æ–∑–¥–∞—ë–º –ø—Ä–æ–º–ø—Ç
            prompt = f"""
            –¢—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –Ω–µ–∑—Ä—è—á–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–∫—Ä–∏–Ω—à–æ—Ç –∏ –¥–∞–π:
            
            1. –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞ (1-2 —Ñ—Ä–∞–∑—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º)
            2. 3-5 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π (–≥–ª–∞–≥–æ–ª–æ–º)
            
            –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: {metadata.get('app_name', 'Unknown')}
            –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ–∫–Ω–∞: {metadata.get('window_title', '')}
            
            –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ JSON:
            {{
              "summary": "–æ–ø–∏—Å–∞–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞",
              "actions": ["–¥–µ–π—Å—Ç–≤–∏–µ 1", "–¥–µ–π—Å—Ç–≤–∏–µ 2", "–¥–µ–π—Å—Ç–≤–∏–µ 3"],
              "confidence": 0.85,
              "screen_type": "search_results|listing|form|article|dialog"
            }}
            """
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
            response = self.model.generate_content([
                prompt,
                {"mime_type": "image/webp", "data": image_base64}
            ])
            
            # –ü–∞—Ä—Å–∏–º JSON –æ—Ç–≤–µ—Ç
            try:
                result = json.loads(response.text)
                return result
            except json.JSONDecodeError:
                # Fallback –µ—Å–ª–∏ JSON –Ω–µ –ø–∞—Ä—Å–∏—Ç—Å—è
                return {
                    "summary": "–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç–∫—Ä–∞–Ω",
                    "actions": ["–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑"],
                    "confidence": 0.5,
                    "screen_type": "unknown"
                }
                
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ Gemini API: {e}")
            return {
                "summary": "–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ —ç–∫—Ä–∞–Ω–∞",
                "actions": ["–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ"],
                "confidence": 0.0,
                "screen_type": "error"
            }
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–∞–±–æ—Ç–∞—é—â–∏–π –∞–Ω–∞–ª–∏–∑ —ç–∫—Ä–∞–Ω–∞ —á–µ—Ä–µ–∑ Gemini API

---

### **–®–ê–ì 7: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (–î–µ–Ω—å 12-13)**

#### **7.1 –°–æ–∑–¥–∞–Ω–∏–µ Analytics:**
```python
# src/services/analytics.py
import hashlib
import subprocess
import time
import json
import requests
from typing import Dict, Any

class Analytics:
    def __init__(self, server_url: str = None):
        self.server_url = server_url
        self.user_id = self._generate_user_id()
        self.session_id = self._generate_session_id()
        self.events = []
        self.last_send = time.time()
        
    def _generate_user_id(self) -> str:
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        try:
            # –ü–æ–ª—É—á–∞–µ–º MAC –∞–¥—Ä–µ—Å
            mac = subprocess.check_output(['ifconfig', 'en0']).decode()
            mac_match = re.search(r'ether ([0-9a-f:]+)', mac)
            mac_addr = mac_match.group(1) if mac_match else "unknown"
            
            # –ü–æ–ª—É—á–∞–µ–º Serial Number
            serial = subprocess.check_output(['system_profiler', 'SPHardwareDataType']).decode()
            serial_match = re.search(r'Serial Number \(system\): (.+)', serial)
            system_serial = serial_match.group(1) if serial_match else "unknown"
            
            # –ö–æ–º–±–∏–Ω–∏—Ä—É–µ–º –∏ —Ö–µ—à–∏—Ä—É–µ–º
            combined = f"{mac_addr}:{system_serial}"
            return hashlib.sha256(combined.encode()).hexdigest()[:16]
            
        except:
            return hashlib.sha256(str(time.time()).encode()).hexdigest()[:16]
            
    def _generate_session_id(self) -> str:
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç ID —Å–µ—Å—Å–∏–∏"""
        return f"session_{int(time.time())}"
        
    def log_event(self, event_type: str, data: Dict[str, Any] = None):
        """–õ–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ"""
        event = {
            'user_id': self.user_id,
            'session_id': self.session_id,
            'event_type': event_type,
            'timestamp': time.time(),
            'data': data or {}
        }
        
        self.events.append(event)
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∫–∞–∂–¥—ã–µ 50 —Å–æ–±—ã—Ç–∏–π
        if len(self.events) >= 50:
            self._send_to_server()
            
    def log_performance(self, operation: str, duration_ms: float):
        """–õ–æ–≥–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"""
        self.log_event('performance', {
            'operation': operation,
            'duration_ms': duration_ms
        })
        
    def _send_to_server(self):
        """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä"""
        if not self.server_url or not self.events:
            return
            
        try:
            payload = {
                'user_id': self.user_id,
                'events': self.events,
                'timestamp': time.time()
            }
            
            response = requests.post(
                f"{self.server_url}/analytics/events",
                json=payload,
                timeout=10
            )
            
            if response.status_code == 200:
                self.events.clear()
                
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏: {e}")
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–∞–±–æ—Ç–∞—é—â–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

### **–®–ê–ì 8: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–î–µ–Ω—å 14-15)**

#### **8.1 –°–æ–∑–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞:**
```python
# src/core/assistant.py
import asyncio
import time
from typing import Dict, Any

class VoiceAssistant:
    def __init__(self, config: Dict[str, Any]):
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
        self.space_controller = SpaceController()
        self.screen_capture = ScreenCapture()
        self.tts_engine = EdgeTTSEngine()
        self.speech_recognition = LocalSpeechRecognition()
        self.gemini_client = GeminiClient(config['gemini_api_key'])
        self.analytics = Analytics(config.get('analytics_server'))
        
        # –°–æ—Å—Ç–æ—è–Ω–∏–µ
        self.state = 'inactive'  # inactive, active, interrupted, listening
        self.is_speaking = False
        
        # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º callbacks
        self.space_controller.register_callback('activate', self._activate)
        self.space_controller.register_callback('deactivate', self._deactivate)
        self.space_controller.register_callback('interrupt', self._interrupt)
        
    def start(self):
        """–ó–∞–ø—É—Å–∫–∞–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞"""
        print("üöÄ –ó–∞–ø—É—Å–∫ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞...")
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–±–µ–ª–∞
        self.space_controller.start_monitoring()
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –≥–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª
        try:
            asyncio.run(self._main_loop())
        except KeyboardInterrupt:
            print("\nüëã –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞...")
            
    async def _main_loop(self):
        """–ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã"""
        while True:
            await asyncio.sleep(0.1)
            
    def _activate(self):
        """–ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞"""
        if self.state == 'inactive':
            self.state = 'active'
            self.analytics.log_event('assistant_activated')
            
            # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —ç–∫—Ä–∞–Ω
            asyncio.create_task(self._analyze_screen())
            
    def _deactivate(self):
        """–î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞"""
        if self.state != 'inactive':
            self.state = 'inactive'
            self.is_speaking = False
            self.tts_engine.stop_speaking()
            self.analytics.log_event('assistant_deactivated')
            
    def _interrupt(self):
        """–ü–µ—Ä–µ–±–∏–≤–∞–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞"""
        if self.state == 'active' and self.is_speaking:
            self.state = 'interrupted'
            self.is_speaking = False
            self.tts_engine.stop_speaking()
            self.analytics.log_event('assistant_interrupted')
            
    async def _analyze_screen(self):
        """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —ç–∫—Ä–∞–Ω"""
        try:
            start_time = time.time()
            
            # –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω
            image_bytes, metadata = self.screen_capture.capture_active_window()
            if not image_bytes:
                return
                
            self.analytics.log_performance('screen_capture', 
                (time.time() - start_time) * 1000)
            
            # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —á–µ—Ä–µ–∑ Gemini
            analysis_start = time.time()
            result = self.gemini_client.analyze_screen(image_bytes, metadata)
            self.analytics.log_performance('llm_analysis', 
                (time.time() - analysis_start) * 1000)
            
            # –°–∏–Ω—Ç–µ–∑–∏—Ä—É–µ–º —Ä–µ—á—å
            tts_start = time.time()
            audio_bytes = await self.tts_engine.synthesize(result['summary'])
            self.analytics.log_performance('tts_synthesis', 
                (time.time() - tts_start) * 1000)
            
            # –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º
            self.is_speaking = True
            self.tts_engine.play_audio(audio_bytes)
            self.is_speaking = False
            
            # –õ–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—Ö
            self.analytics.log_performance('total_response', 
                (time.time() - start_time) * 1000)
            self.analytics.log_event('screen_analysis_complete', {
                'confidence': result['confidence'],
                'screen_type': result['screen_type']
            })
            
        except Exception as e:
            self.analytics.log_event('error', {
                'error_type': type(e).__name__,
                'error_message': str(e)
            })
            print(f"–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ —ç–∫—Ä–∞–Ω–∞: {e}")
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç

---

### **–®–ê–ì 9: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–î–µ–Ω—å 16)**

#### **9.1 –°–æ–∑–¥–∞–Ω–∏–µ config.json:**
```json
{
  "gemini_api_key": "YOUR_GEMINI_API_KEY",
  "analytics_server": "https://your-analytics-server.com",
  
  "space_control": {
    "long_press_threshold": 600,
    "short_press_threshold": 300
  },
  
  "screen_capture": {
    "max_width": 1024,
    "quality": 80
  },
  
  "tts": {
    "voice": "ru-RU-SvetlanaNeural",
    "rate": "+0%",
    "volume": "+0%"
  },
  
  "speech_recognition": {
    "language": "ru-RU",
    "timeout": 10,
    "energy_threshold": 4000
  },
  
  "logging": {
    "level": "INFO",
    "file": "assistant.log"
  }
}
```

#### **9.2 –°–æ–∑–¥–∞–Ω–∏–µ main.py:**
```python
# main.py
import json
import sys
from src.core.assistant import VoiceAssistant

def main():
    try:
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
        with open('config.json', 'r') as f:
            config = json.load(f)
            
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º API –∫–ª—é—á
        if not config.get('gemini_api_key'):
            print("‚ùå –û—à–∏–±–∫–∞: –Ω–µ —É–∫–∞–∑–∞–Ω GEMINI_API_KEY –≤ config.json")
            sys.exit(1)
            
        # –°–æ–∑–¥–∞—ë–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
        assistant = VoiceAssistant(config)
        assistant.start()
        
    except FileNotFoundError:
        print("‚ùå –û—à–∏–±–∫–∞: —Ñ–∞–π–ª config.json –Ω–µ –Ω–∞–π–¥–µ–Ω")
        sys.exit(1)
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: {e}")
        sys.exit(1)

if __name__ == "__main__":
    main()
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ì–æ—Ç–æ–≤–æ–µ –∫ –∑–∞–ø—É—Å–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

---

### **–®–ê–ì 10: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–î–µ–Ω—å 17-18)**

#### **10.1 –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
```python
# tests/test_assistant.py
import unittest
from unittest.mock import Mock, patch
from src.core.assistant import VoiceAssistant

class TestVoiceAssistant(unittest.TestCase):
    def setUp(self):
        self.config = {
            'gemini_api_key': 'test_key',
            'analytics_server': None
        }
        self.assistant = VoiceAssistant(self.config)
        
    def test_activation(self):
        """–¢–µ—Å—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞"""
        self.assertEqual(self.assistant.state, 'inactive')
        self.assistant._activate()
        self.assertEqual(self.assistant.state, 'active')
        
    def test_deactivation(self):
        """–¢–µ—Å—Ç –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞"""
        self.assistant._activate()
        self.assistant._deactivate()
        self.assertEqual(self.assistant.state, 'inactive')
        
    def test_interruption(self):
        """–¢–µ—Å—Ç –ø–µ—Ä–µ–±–∏–≤–∞–Ω–∏—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞"""
        self.assistant._activate()
        self.assistant.is_speaking = True
        self.assistant._interrupt()
        self.assertEqual(self.assistant.state, 'interrupted')
        self.assertFalse(self.assistant.is_speaking)

if __name__ == '__main__':
    unittest.main()
```

#### **10.2 –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:**
```bash
# –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã
python -m pytest tests/ -v

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–∫—Ä—ã—Ç–∏–µ
python -m pytest tests/ --cov=src --cov-report=html
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

---

## üöÄ **–ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

### **1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º –ø—Ä–æ–µ–∫—Ç
git clone <repository_url>
cd assistant_app

# –°–æ–∑–¥–∞—ë–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv venv
source venv/bin/activate  # macOS/Linux
# venv\Scripts\activate  # Windows

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

### **2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
```bash
# –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cp config.example.json config.json

# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º config.json
# –î–æ–±–∞–≤–ª—è–µ–º GEMINI_API_KEY
```

### **3. –ó–∞–ø—É—Å–∫:**
```bash
# –ó–∞–ø—É—Å–∫–∞–µ–º –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
python main.py

# –í —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
nohup python main.py > assistant.log 2>&1 &
```

---

## ‚ö†Ô∏è **–†–∏—Å–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è**

### **1. –†–∞–∑—Ä–µ—à–µ–Ω–∏—è macOS:**
- **–†–∏—Å–∫:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –¥–∞—Å—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
- **–†–µ—à–µ–Ω–∏–µ:** –ß—ë—Ç–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–¥–µ

### **2. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- **–†–∏—Å–∫:** –ü—Ä–æ–±–ª–µ–º—ã —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π PyAudio/PyObjC
- **–†–µ—à–µ–Ω–∏–µ:** –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã

### **3. API –ª–∏–º–∏—Ç—ã:**
- **–†–∏—Å–∫:** –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ Gemini API
- **–†–µ—à–µ–Ω–∏–µ:** –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã

### **4. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- **–†–∏—Å–∫:** –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞ —Å–ª–∞–±—ã—Ö –º–∞—à–∏–Ω–∞—Ö
- **–†–µ—à–µ–Ω–∏–µ:** –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

### **5. –°–µ—Ç—å:**
- **–†–∏—Å–∫:** –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º
- **–†–µ—à–µ–Ω–∏–µ:** –õ–æ–∫–∞–ª—å–Ω—ã–µ fallback –∏ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º

---

## üìä **–ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞**

### **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ:**
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –ü—Ä–æ–±–µ–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º
- ‚úÖ –ó–∞—Ö–≤–∞—Ç —ç–∫—Ä–∞–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ TTS —Å–∏–Ω—Ç–µ–∑–∏—Ä—É–µ—Ç —Ä–µ—á—å
- ‚úÖ STT —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç –∫–æ–º–∞–Ω–¥—ã
- ‚úÖ Gemini –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —ç–∫—Ä–∞–Ω—ã

### **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ:**
- ‚úÖ –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –¥–æ–ª–≥–∏–º –Ω–∞–∂–∞—Ç–∏–µ–º –ø—Ä–æ–±–µ–ª–∞
- ‚úÖ –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–µ—Ä–µ–±–∏–≤–∞–µ—Ç—Å—è –∫–æ—Ä–æ—Ç–∫–∏–º –ø—Ä–æ–±–µ–ª–æ–º
- ‚úÖ –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç –≤—ã–∫–ª—é—á–∞–µ—Ç—Å—è –¥–æ–ª–≥–∏–º –Ω–∞–∂–∞—Ç–∏–µ–º
- ‚úÖ –¢–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞
- ‚úÖ VoiceOver —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üéØ **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏**

### **–ü–æ—Å–ª–µ MVP 1:**
1. **–°–±–æ—Ä –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏** –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. **–ê–Ω–∞–ª–∏–∑ –º–µ—Ç—Ä–∏–∫** –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö
4. **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ MVP 2** —Å —ç—Ö–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ–º

### **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ:**
1. **–ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è** (iOS/Android)
2. **–û–±–ª–∞—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** –Ω–∞—Å—Ç—Ä–æ–µ–∫
3. **–ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ** –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** —Å –¥—Ä—É–≥–∏–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏

---

## üéâ **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**

**–≠—Ç–æ—Ç –ø–ª–∞–Ω –¥–∞—ë—Ç –Ω–∞–º:**

üöÄ **–ß—ë—Ç–∫—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - 18 –¥–Ω–µ–π –¥–æ –ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í–û–ì–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
üéØ **–ü—Ä–æ—Å—Ç—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** - –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä
üõ°Ô∏è **–û–±—Ä–∞–±–æ—Ç–∫—É —Ä–∏—Å–∫–æ–≤** - –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã
üìä **–ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞** - –ø–æ–Ω–∏–º–∞–Ω–∏–µ —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚ö° **–ë—ã—Å—Ç—Ä—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç** - MVP 1 –∑–∞ 3 –Ω–µ–¥–µ–ª–∏

**–ü–ª–∞–Ω –≥–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏! –ú–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å —Å –®–ê–ì–ê 1: "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è"** üéØ

**–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∏–Ω–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –ø–æ —ç—Ç–æ–º—É –ø–ª–∞–Ω—É?**
