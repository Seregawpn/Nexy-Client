#!/bin/bash

# üîÑ Nexy AI Assistant - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./scripts/switch_to_version.sh [–≤–µ—Ä—Å–∏—è]

set -e

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

log() {
    echo -e "${GREEN}[INFO]${NC} $1"
}

warn() {
    echo -e "${YELLOW}[WARN]${NC} $1"
}

error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

info() {
    echo -e "${BLUE}[INFO]${NC} $1"
}

# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞
cd "$(dirname "$0")/.."

# –ï—Å–ª–∏ –≤–µ—Ä—Å–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫
if [ $# -eq 0 ]; then
    log "üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–µ—Ä—Å–∏–∏:"
    echo ""
    
    git tag -l | sort -V | tail -10
    
    echo ""
    log "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 <–≤–µ—Ä—Å–∏—è>"
    log "–ü—Ä–∏–º–µ—Ä: $0 v1.0.0"
    exit 0
fi

VERSION=$1

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤–µ—Ä—Å–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
if ! git tag -l | grep -q "^$VERSION$"; then
    error "–í–µ—Ä—Å–∏—è $VERSION –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!"
    echo ""
    log "–î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–µ—Ä—Å–∏–∏:"
    git tag -l | sort -V
    exit 1
fi

log "üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–µ—Ä—Å–∏—é $VERSION..."

# –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –≤–µ—Ç–∫—É
CURRENT_BRANCH=$(git branch --show-current)

# –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Ç–µ–≥
git checkout "$VERSION"

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–µ—Ä—Å–∏–∏
echo ""
log "üìÑ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–µ—Ä—Å–∏–∏:"
git show --no-patch --format="   –í–µ—Ä—Å–∏—è: %D%n   –î–∞—Ç–∞: %ci%n   –ê–≤—Ç–æ—Ä: %an%n   –ö–æ–º–º–∏—Ç: %H" "$VERSION"

echo ""
log "‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–µ—Ä—Å–∏—é $VERSION –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
log "üìÅ –¢–µ–∫—É—â–∞—è –≤–µ—Ç–∫–∞: $CURRENT_BRANCH (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞)"

echo ""
log "üîß –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
log "‚Ä¢ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: pip install -r requirements.txt"
log "‚Ä¢ –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: python main.py"

echo ""
log "üîÑ –î–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏:"
log "git checkout $CURRENT_BRANCH"
